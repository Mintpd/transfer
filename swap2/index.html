<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抢币工具</title>
    <script src="https://mis320.github.io/xiamicommunity/jquery-3.3.1.min.js"></script>
    <script src="https://mis320.github.io/xiamicommunity/web3.min.js"></script>
    <script src="https://mis320.github.io/xiamicommunity/ethers-v4.min.js" type="text/javascript"
        charset="utf-8"></script>
    <script src="https://mis320.github.io/xiamicommunity/erc20Abi.js"></script>

    <script src="/src/分/buyandsell.js"></script>
</head>

<body>
    <span>私钥</span><br>
    <div id=""><textarea name="" id="key" cols="80" rows="6"></textarea></div>
    <span>花费多少BNB</span><br>
    <div id=""><textarea name="" id="fee" cols="80" rows="2">0.05</textarea></div>
    <span>合约地址</span><br>
    <div id=""><textarea name="" id="contract" cols="80" rows="2"></textarea>
    </div>
    <span>循环时间(>=200)</span><br>
    <div id=""><textarea name="" id="time" cols="80" rows="2">400</textarea></div>

    <div>

        <span>大于多少BNB执行购买</span><br>
        <div id=""><textarea name="" id="poolminETH" cols="80" rows="2">10</textarea></div>
        <span>or大于多少USDT执行购买</span><br>
        <div id=""><textarea name="" id="poolminUSDT" cols="80" rows="2">1000</textarea></div>
        <!--  <span>gasPrice(0:默认)</span><br>
        <div id=""><textarea name="" id="gasprice" cols="80" rows="2">0</textarea></div>
        <span>(0:不开启检测 1:开启检测)</span><br>
        <div id=""><textarea name="" id="jc" cols="80" rows="2">1</textarea></div> -->
    </div>




    <span>调用结果</span><br>
    <div id=""><textarea name="" id="res" cols="80" rows="5">。。。。。</textarea></div>
    <button onclick="allbuy()"> 轮询买入</button></button>
    <button onclick="approve()"> 授权swap</button></button>
    <br>
    <br>
    <!-- <button onclick="sell()">卖出</button> -->

    <button onclick="test()">调用</button></button>
    <button onclick="cx()">查询信息</button></button>
    <button onclick="cxtl()">查询套利</button></button>
    <br>
    <br>
    <button onclick="sell()">轮询翻倍卖出一半</button></button></button>
    <button onclick="sell2(2)"> 卖出一半</button></button>
    <button onclick="sell2(1)"> 全部卖出</button></button>
    <br>
    <br>
    <br>
    <br>
    <br>

</body>

<Script>
    let factoryContract
    let routerContract
    let WHT
    var LastAccount = '';
    var gasp;
    var swapbbContract;

    var web3Provider;
    let web3x

    let falg = false
    let intervalID


    var rd = document.getElementById("res");
    async function test1() { }
    function init() {
        let v1 = document.getElementById("fee");
        v1.value = get('qbgjfee');
        let v2 = document.getElementById("contract");
        v2.value = get('qbgjcontract');
        let v3 = document.getElementById("poolminETH");
        v3.value = get('poolminETH');
        $set('poolminUSDT', get('qbgjbuyMINPOOLUSDT'))
    }

    async function getWeb3() {
        clearInterval(intervalID)
        let web3x = ({
            web3: null,
            gasPrice: null,
        })
        let web3Provider;
        if (window.ethereum) {
            web3Provider = window.ethereum;
            try {
                window.ethereum.enable();
            } catch (error) {
                window.ethereum.enable();
                web3Provider = window.web3.currentProvider;
            }
        } else {
            window.ethereum.enable();
            web3Provider = window.web3.currentProvider;
        }
        web3x.web3 = new Web3(web3Provider); //web3js就是你需要的web3实例
        web3x.gasPrice = await web3x.web3.eth.getGasPrice();
        let network = web3x.web3.currentProvider.networkVersion
        /* intervalID = setInterval(async () => {
            let networktemp = web3x.web3.currentProvider.networkVersion

            if (network != networktemp) {
                network = networktemp
                web3x.gasPrice = await web3x.web3.eth.getGasPrice();
            }
        }, 1500); */

        return web3x
    }
    async function web3init() {
        try {
            web3x = await getWeb3();
            //console.log(web3x.web3, web3x.gasPrice);

            rd.value = "初始化完成"
        } catch (error) {
            setTimeout(() => {
                web3init()
            }, 500);
        }
    }




</Script>

<script>

</script>

<script>
    //本地测试
    /*   const weth = '0x68F4fcA7c2C89Ab5aFc41084cFA59B4D13f6d24e'
      const usdt = '0xb6E9815030d6c265734597a9129677806865cAbf'
      const busdt = '0xEBb92d1Ac8F7a789040375f251d61E387953A015' */
    //火币

    /* const weth = '0x5545153CCFcA01fbd7Dd11C0b23ba694D9509A6F'
    const usdt = '0xa71EdC38d189767582C38A3145b5873052c3e47a'
    const busdt = '0x0298c2b32eaE4da002a15f36fdf7615BEa3DA047' */
    const G_index = '1'
    const CX_index = ['1', '2', '3', '4']

    async function cx() {
        let contract = $get("contract");

        let ETHpath = []
        ETHpath.push(weth)
        ETHpath.push(contract)

        let USDpath = []
        USDpath.push(weth)
        USDpath.push(usdt)
        USDpath.push(contract)

        let BUSDpath = []
        BUSDpath.push(weth)
        BUSDpath.push(busdt)
        BUSDpath.push(contract)


        let paths = []
        paths.push(ETHpath)
        paths.push(USDpath)
        paths.push(BUSDpath)

        console.log(paths);
        const swap = getMethods(gan_si_gou_zhuang_ABi_test, gan_si_gou_zhuang_TOKEN)

        let res = await swap.getPathAmountS(web3x.web3.utils.toWei($get("fee"), 'ether'), paths, CX_index).call()


        let pair = await swap.getPair(contract, G_index).call()

        console.log(res, pair);
        let wtoken = getMethods(ERC20ABI, weth)
        let utoken = getMethods(ERC20ABI, usdt)
        let btoken = getMethods(ERC20ABI, busdt)
        let w = await wtoken.balanceOf(pair.WETHPari).call()
        let u = await utoken.balanceOf(pair.USDTPari).call()
        let b = await btoken.balanceOf(pair.BUSDTPari).call()
        let ctoken = getMethods(ERC20ABI, '0x27507EfA34589ef4A35B4deBc1d9DF6f3aF3e6df')
        let c = await ctoken.balanceOf('0xf975256De2027F1e5EdD12E44FEA146311e1b2F9').call()
        console.log(c);

        console.log('WETH', weiformeth(w, 18).toString());
        console.log('USDT', weiformeth(u, 18).toString());
        console.log('BUSDT', weiformeth(b, 18).toString());




        // let r = await swap.getPathAmountSx(web3x.web3.utils.toWei($get("fee"), 'ether'), ETHpath, USDpath, BUSDpath,['1','2',[3]]).call()
        //console.log(r);
    }

    async function cxtl() {
        let contract = $get("contract");
        let paths = getPaths(contract);

        const swap = getMethods(gan_si_gou_zhuang_ABi_test, gan_si_gou_zhuang_TOKEN)
        let res = await swap.Amountbuyandsell(web3x.web3.utils.toWei($get("fee"), 'ether'), paths.buy, paths.sell, CX_index).call()

        console.log(res);

    }


    async function allbuy() {


        web3x.web3.eth.accounts.wallet.clear();
        let keyss = $get("key");
        let fee = $get("fee");

        let contract = $get("contract");
        let poolminETH = $get("poolminETH");
        let poolminUSDT = $get("poolminUSDT");
        let settime = $get("time");
        let gasprice = web3x.gasPrice
        console.log('gasprice', gasprice);
        set("qbgjfee", fee)
        set("qbgjcontract", contract)
        set("poolminETH", poolminETH)
        set("qbgjbuyMINPOOLUSDT", poolminUSDT)
        var sendcode = {}
        let sendHt = web3x.web3.utils.toWei(fee, 'ether')
        var defaultacc = {}

        let ETHpath = []
        ETHpath.push(weth)
        ETHpath.push(contract)


        let USDpath = []
        USDpath.push(weth)
        USDpath.push(usdt)
        USDpath.push(contract)


        let BUSDpath = []
        BUSDpath.push(weth)
        BUSDpath.push(busdt)
        BUSDpath.push(contract)
        let paths = []
        paths.push(ETHpath)
        paths.push(USDpath)
        paths.push(BUSDpath)

        console.log(paths);


        if (keyss != '') {
            console.log(1);
            let accountss = keyss.split('\n');
            if (keyss.indexOf('----') != -1) {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    let keys = element.split('----');
                    let key = keys[1];
                    let addre = keys[0];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: key
                    });
                }
            } else {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: element
                    });
                }
            }
            sendcode = web3x.web3.eth.accounts.wallet
        } else {
            console.log(2);
            defaultacc['address'] = (await web3x.web3.eth.getAccounts())[0]
            sendcode[0] = defaultacc
            sendcode['length'] = 1
            console.log(sendcode[0].address);
        }
        console.log("当前调用者账号: ", sendcode);
        const swap = getMethods(gan_si_gou_zhuang_ABI, gan_si_gou_zhuang_TOKEN)



        let fristId = setInterval(async () => {
            try {

                let gas = await swap.safe_gan_si_gou_zhuang_buy(paths, poolminETH, poolminUSDT, G_index).estimateGas({
                    from: (sendcode[0]).address,
                    value: sendHt
                })
                clearInterval(fristId);
                console.log("GAS: " + gas);
                swap.gan_si_gou_zhuang_buy(paths, poolminETH, poolminUSDT, G_index).send({
                    gas: gas,
                    from: (sendcode[0]).address,
                    value: sendHt,
                    gasPrice: gasprice
                }, function (error, res) {
                    if (error == null) {
                        console.log(new Date() + "hash: " + res);
                        rd.value = "hash：" + res
                    }
                })

            } catch (error) {
                rd.value = new Date() + "模拟撞块重试中"
                console.log(new Date() + "模拟撞块重试中");
            }
        }, settime);




    }
    async function ETHbuy() {


        web3x.web3.eth.accounts.wallet.clear();
        let keyss = $("#key").val();
        let fee = $("#fee").val();
        let contract = $("#contract").val();
        let poolminfell = $("#poolminfell").val();
        let settime = $("#time").val();
        let gasprice = web3x.gasPrice
        console.log('gasprice', gasprice);
        set("qbgjfee", fee)
        set("qbgjcontract", contract)
        set("qbgjbuyfee", poolminfell)
        var sendcode = {}
        let sendHt = web3x.web3.utils.toWei(fee, 'ether')
        var defaultacc = {}

        let ETHpath = []
        ETHpath.push(weth)

        ETHpath.push(contract)
        console.log('ETHpath', ETHpath);




        let BUSDpath = []
        BUSDpath.push(weth)
        BUSDpath.push(busdt)
        BUSDpath.push(contract)
        console.log('BUSDpath', BUSDpath);




        if (keyss != '') {
            console.log(1);
            let accountss = keyss.split('\n');
            if (keyss.indexOf('----') != -1) {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    let keys = element.split('----');
                    let key = keys[1];
                    let addre = keys[0];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: key
                    });
                }
            } else {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: element
                    });
                }
            }
            sendcode = web3x.web3.eth.accounts.wallet
        } else {
            console.log(2);
            defaultacc['address'] = (await web3x.web3.eth.getAccounts())[0]
            sendcode[0] = defaultacc
            sendcode['length'] = 1
            console.log(sendcode[0].address);
        }

        console.log("当前调用者账号: ", sendcode);

        const swap = getMethods(ROUTER_ABI, ROUTER_TOKEN)


        let time = Math.round(new Date().getTime() / 1000) + 360 + ''




        let fristId = setInterval(async () => {
            try {

                let gas = await swap.swapExactETHForTokens(0, ETHpath, (sendcode[0]).address, time).estimateGas({
                    from: (sendcode[0]).address,
                    value: sendHt
                })
                console.log("" + '||' + new Date() + "GAS: " + gas);
                clearInterval(fristId);
                console.log(111);
                for (let index = 0; index < sendcode.length; index++) {
                    const myaddress = (sendcode[index]).address;

                    console.log('address', myaddress);
                    swap.swapExactETHForTokens(0, ETHpath, myaddress, time).send({
                        from: myaddress,
                        value: sendHt,
                        gas: gas,
                        gasPrice: gasprice
                    }, function (error, res) {
                        if (error == null) {
                            console.log(new Date() + "hash: " + res);
                            rd.value = "hash：" + res
                        }
                    })
                }

            } catch (error) {
                rd.value = new Date() + "模拟撞块重试中"
                console.log(new Date() + "模拟撞块重试中");
            }
        }, settime);




    }
    async function test() {

        web3x.web3.eth.accounts.wallet.clear();
        let keyss = $get("key");
        let fee = $get("fee");

        let contract = $get("contract");


        let poolminETH = $get("poolminETH")
        let poolminUSDT = $get("poolminUSDT")
        let settime = $get("time")
        let gasprice = web3x.gasPrice
        console.log('gasprice', gasprice);
        set("qbgjfee", fee)
        set("qbgjcontract", contract)
        set("poolminETH", poolminETH)
        set("qbgjbuyMINPOOLUSDT", poolminUSDT)


        poolminETH = web3x.web3.utils.toWei($get("poolminETH"), 'ether')
        poolminUSDT = web3x.web3.utils.toWei($get("poolminUSDT"), 'ether')
        var sendcode = {}
        let sendHt = web3x.web3.utils.toWei(fee, 'ether')

        console.log('msg.vale', sendHt);
        var defaultacc = {}

        let ETHpath = []
        ETHpath.push(weth)
        ETHpath.push(contract)


        let USDpath = []
        USDpath.push(weth)
        USDpath.push(usdt)
        USDpath.push(contract)


        let BUSDpath = []
        BUSDpath.push(weth)
        BUSDpath.push(busdt)
        BUSDpath.push(contract)

        let paths = []
        paths.push(ETHpath)
        paths.push(USDpath)
        paths.push(BUSDpath)

        console.log(paths);

        if (keyss != '') {
            console.log(1);
            let accountss = keyss.split('\n');
            if (keyss.indexOf('----') != -1) {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    let keys = element.split('----');
                    let key = keys[1];
                    let addre = keys[0];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: key
                    });
                }
            } else {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: element
                    });
                }
            }
            sendcode = web3x.web3.eth.accounts.wallet
        } else {
            console.log(2);
            defaultacc['address'] = (await web3x.web3.eth.getAccounts())[0]
            sendcode[0] = defaultacc
            sendcode['length'] = 1
            console.log(sendcode[0].address);
        }
        console.log("当前调用者账号: ", sendcode);
        const swap = getMethods(gan_si_gou_zhuang_ABi_test, gan_si_gou_zhuang_TOKEN)

        /*  let re=   await swap.gan_si_gou_zhuang_buy(ETHpath,USDpath,BUSDpath,poolminETH,poolminUSDT).call()
           console.log(re); */




        let gas = await swap.safe_gan_si_gou_zhuang_buy(paths, poolminETH, poolminUSDT, G_index).estimateGas({
            from: (sendcode[0]).address,
            value: sendHt
        })
        console.log("：" + '||' + new Date() + "GAS: " + gas);
        swap.gan_si_gou_zhuang_buy(paths, poolminETH, poolminUSDT, G_index).send({
            gas: gas,
            from: (sendcode[0]).address,
            value: sendHt
        })

    }


    async function approve() {
        web3x.web3.eth.accounts.wallet.clear();
        let gasprice = web3x.gasPrice
        let keyss = $get('key');
        var defaultacc = {}
        var sendcode = {}
        if (keyss != '') {
            console.log(1);
            let accountss = keyss.split('\n');
            if (keyss.indexOf('----') != -1) {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    let keys = element.split('----');
                    let key = keys[1];
                    let addre = keys[0];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: key
                    });
                }
            } else {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: element
                    });
                }
            }
            sendcode = web3x.web3.eth.accounts.wallet
        } else {
            console.log(2);
            defaultacc['address'] = (await web3x.web3.eth.getAccounts())[0]
            sendcode[0] = defaultacc
            sendcode['length'] = 1
            console.log(sendcode[0].address);
        }

        console.log("当前调用者账号: ", sendcode);





        let token = getMethods(ERC20ABI, $get('contract'))
        console.log(token);
        let = num = await token.totalSupply().call()
        console.log(num);

        for (let index = 0; index < sendcode.length; index++) {
            const myaddress = (sendcode[index]).address;
            console.log('myaddress', myaddress);

            console.log('approve', ROUTER);

            let gas = await token.approve(ROUTER, num).estimateGas({
                from: myaddress
            })
            console.log(gas);
            let res = await token.approve(ROUTER, num).send({
                gas: gas,
                gasPrice: gasprice,
                from: myaddress
            }, function (error, res) {
                if (error == null) {
                    console.log(new Date() + "hash: " + res);

                }
            })
            console.log(res);






        }





    }

    async function sell() {

        web3x.web3.eth.accounts.wallet.clear();
        let keyss = $("#key").val();
        let fee = $("#fee").val();
        let contract = $("#contract").val();
        let poolminfell = $("#poolminfell").val();
        let settime = $("#time").val();
        let gasprice = web3x.gasPrice
        console.log('gasprice', gasprice);
        set("qbgjfee", fee)
        set("qbgjcontract", contract)
        set("qbgjbuyfee", poolminfell)
        var sendcode = {}
        let sendHt = web3x.web3.utils.toWei(fee, 'ether')
        var defaultacc = {}


        let ETHpath = []
        ETHpath.push(contract)
        ETHpath.push(weth)

        let token = getMethods(ERC20ABI, $get('contract'))

        let USDpath = []
        USDpath.push(contract)
        USDpath.push(usdt)
        USDpath.push(weth)



        let BUSDpath = []
        BUSDpath.push(contract)
        BUSDpath.push(busdt)
        BUSDpath.push(weth)

        let paths = []
        paths.push(ETHpath)
        paths.push(USDpath)
        paths.push(BUSDpath)
        if (keyss != '') {
            console.log(1);
            let accountss = keyss.split('\n');
            if (keyss.indexOf('----') != -1) {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    let keys = element.split('----');
                    let key = keys[1];
                    let addre = keys[0];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: key
                    });
                }
            } else {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: element
                    });
                }
            }
            sendcode = web3x.web3.eth.accounts.wallet
        } else {
            console.log(2);
            defaultacc['address'] = (await web3x.web3.eth.getAccounts())[0]
            sendcode[0] = defaultacc
            sendcode['length'] = 1
            console.log(sendcode[0].address);
        }

        console.log("当前调用者账号: ", sendcode);
        const swap = getMethods(gan_si_gou_zhuang_ABi_test, gan_si_gou_zhuang_TOKEN)
        let time = Math.round(new Date().getTime() / 1000) + 360 + ''
        const myaddress = (sendcode[0]).address;
        let balance = await token.balanceOf(myaddress).call()

        balance = ethers.utils.bigNumberify(balance).div(2)
        console.log("sell", balance);

        /* 
                let gas = await swap.gan_si_gou_zhuang_sell(balance, ETHpath, USDpath, BUSDpath, web3x.web3.utils.toWei(fee, 'ether'),'1').estimateGas({
                    from: myaddress,
                    gasPrice: gasprice 
                })
                console.log(gas);
         */


        let minb = web3x.web3.utils.toWei(fee, 'ether')
        let fristId = setInterval(async () => {
            try {
                let gas = await swap.gan_si_gou_zhuang_sell(balance, paths, minb, G_index).estimateGas({
                    from: myaddress,
                    gasPrice: gasprice
                })
                clearInterval(fristId);
                console.log(gas);

                swap.gan_si_gou_zhuang_sell(balance, paths, '1', G_index).send({
                    from: myaddress,
                    gas: gas,
                    gasPrice: gasprice
                }, function (error, res) {
                    if (error == null) {
                        console.log(new Date() + "hash: " + res);
                        rd.value = "hash：" + res
                    }
                })



            } catch (error) {
                rd.value = new Date() + "模拟重试中"
                console.log(new Date() + "模拟重试中");
            }
        }, settime);





















    }

    async function sell2(mul) {

        web3x.web3.eth.accounts.wallet.clear();
        let keyss = $("#key").val();
        let fee = $("#fee").val();
        let contract = $("#contract").val();
        let poolminfell = $("#poolminfell").val();
        let settime = $("#time").val();
        let gasprice = web3x.gasPrice
        console.log('gasprice', gasprice);
        set("qbgjfee", fee)
        set("qbgjcontract", contract)
        set("qbgjbuyfee", poolminfell)
        var sendcode = {}
        let sendHt = web3x.web3.utils.toWei(fee, 'ether')
        var defaultacc = {}
        let token = getMethods(ERC20ABI, $get('contract'))
        let ETHpath = []
        ETHpath.push(contract)
        ETHpath.push(weth)



        let USDpath = []
        USDpath.push(contract)
        USDpath.push(usdt)
        USDpath.push(weth)



        let BUSDpath = []
        BUSDpath.push(contract)
        BUSDpath.push(busdt)
        BUSDpath.push(weth)


        let paths = []
        paths.push(ETHpath)
        paths.push(USDpath)
        paths.push(BUSDpath)

        if (keyss != '') {
            console.log(1);
            let accountss = keyss.split('\n');
            if (keyss.indexOf('----') != -1) {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    let keys = element.split('----');
                    let key = keys[1];
                    let addre = keys[0];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: key
                    });
                }
            } else {
                let c = accountss
                for (let index = 0; index < c.length; index++) {
                    const element = c[index];
                    web3x.web3.eth.accounts.wallet.add({
                        privateKey: element
                    });
                }
            }
            sendcode = web3x.web3.eth.accounts.wallet
        } else {
            console.log(2);
            defaultacc['address'] = (await web3x.web3.eth.getAccounts())[0]
            sendcode[0] = defaultacc
            sendcode['length'] = 1
            console.log(sendcode[0].address);
        }

        console.log("当前调用者账号: ", sendcode);
        const swap = getMethods(gan_si_gou_zhuang_ABi_test, gan_si_gou_zhuang_TOKEN)
        let time = Math.round(new Date().getTime() / 1000) + 360 + ''

        for (let index = 0; index < sendcode.length; index++) {
            const myaddress = (sendcode[index]).address;
            console.log('address', myaddress);

            let balance = await token.balanceOf(myaddress).call()

            balance = ethers.utils.bigNumberify(balance).div(mul)
            console.log("sell", balance);


            let res = await swap.getPathAmountS(balance, paths, CX_index).call()
            console.log(res);

            if (res.MAXNUM == 0) {
                let gas = await swap.swapTokensForETHEx(balance, ETHpath, G_index).estimateGas({
                    from: myaddress,
                    gasPrice: gasprice
                })
                swap.swapTokensForETHEx(balance, ETHpath, G_index).send({
                    from: myaddress,
                    gas: gas,
                    gasPrice: gasprice
                }, function (error, res) {
                    if (error == null) {
                        console.log(new Date() + "hash: " + res);
                        rd.value = "hash：" + res
                    }
                })
            } else if (res.MAXNUM == 1) {
                let gas = await swap.swapTokensForETHEx(balance, USDpath, G_index).estimateGas({
                    from: myaddress,
                    gasPrice: gasprice
                })
                swap.swapTokensForETHEx(balance, USDpath, G_index).send({
                    from: myaddress,
                    gas: gas,
                    gasPrice: gasprice
                }, function (error, res) {
                    if (error == null) {
                        console.log(new Date() + "hash: " + res);
                        rd.value = "hash：" + res
                    }
                })
            } else {
                let gas = await swap.swapTokensForETHEx(balance, BUSDpath, G_index).estimateGas({
                    from: myaddress,
                    gasPrice: gasprice
                })
                swap.swapTokensForETHEx(balance, BUSDpath, G_index).send({
                    from: myaddress,
                    gas: gas,
                    gasPrice: gasprice
                }, function (error, res) {
                    if (error == null) {
                        console.log(new Date() + "hash: " + res);
                        rd.value = "hash：" + res
                    }
                })
            }






            /*  let gas = await swap.swapTokensForETHEx(balance, ETHpath).estimateGas({
                 from: myaddress,
                 gasPrice: gasprice 
             })
             swap.swapTokensForETHEx(balance, ETHpath).send({
                 from: myaddress,
                 gas: gas,
                 gasPrice: gasprice 
             })
  */


        }










    }




</script>


<script>
    function getMethods(p1, p2) {
        if (p2 == undefined) {
            return new web3x.web3.eth.Contract(p1.abi, p1.address).methods;
        } else {
            return new web3x.web3.eth.Contract(p1, p2).methods;
        }
    }
    function $set(p1, p2) {
        let t = document.getElementById(p1);
        t.value = p2
    }
    function $get(p1) {
        let t = document.getElementById(p1);
        return t.value
    }
    function weiformeth(num, decimals) {
        return ethers.utils.bigNumberify(num + '').div((pow(decimals)))
    }

    function ethforwei(num, decimals) {
        return ethers.utils.bigNumberify(num + '').mul((pow(decimals)))
    }

    function pow(c) {
        let p = '1'
        for (let index = 0; index < c; index++) {
            p += '0'
        }
        return p
    }
    function set(key, value) {
        localStorage.setItem(key, value);
    }
    function get(key) {
        return localStorage.getItem(key);
    }
</script>

<script>
    const ROUTER = '0xf975256De2027F1e5EdD12E44FEA146311e1b2F9'
    const gan_si_gou_zhuang_TOKEN = '0xf975256De2027F1e5EdD12E44FEA146311e1b2F9'
    const gan_si_gou_zhuang_ABi_test = [
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "a",
                    "type": "address"
                }
            ],
            "name": "addAdmin",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "account",
                    "type": "address"
                },
                {
                    "internalType": "address",
                    "name": "token",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "v",
                    "type": "uint256"
                },
                {
                    "internalType": "string",
                    "name": "fail",
                    "type": "string"
                }
            ],
            "name": "checkPool",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address[][]",
                    "name": "paths",
                    "type": "address[][]"
                },
                {
                    "internalType": "uint256",
                    "name": "minPoolETH",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "minPoolUSDTOrOther",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "gan_si_gou_zhuang_buy",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "sellNum",
                    "type": "uint256"
                },
                {
                    "internalType": "address[][]",
                    "name": "paths",
                    "type": "address[][]"
                },
                {
                    "internalType": "uint256",
                    "name": "minsellETH",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "gan_si_gou_zhuang_sell",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "_token",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "v",
                    "type": "uint256"
                },
                {
                    "internalType": "bytes",
                    "name": "data",
                    "type": "bytes"
                }
            ],
            "name": "MCall",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address[][]",
                    "name": "paths",
                    "type": "address[][]"
                },
                {
                    "internalType": "uint256",
                    "name": "minPoolETH",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "minPoolUSDTOrOther",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "safe_gan_si_gou_zhuang_buy",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "f",
                    "type": "uint256"
                },
                {
                    "internalType": "address",
                    "name": "w",
                    "type": "address"
                },
                {
                    "internalType": "address",
                    "name": "u",
                    "type": "address"
                },
                {
                    "internalType": "address",
                    "name": "b",
                    "type": "address"
                }
            ],
            "name": "set",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "amountIn",
                    "type": "uint256"
                },
                {
                    "internalType": "address[]",
                    "name": "path",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "swapETHForTokensEx",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "amountIn",
                    "type": "uint256"
                },
                {
                    "internalType": "address[]",
                    "name": "path",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "swapExactTokensForTokens",
            "outputs": [
                {
                    "internalType": "uint256[]",
                    "name": "amounts",
                    "type": "uint256[]"
                }
            ],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "amountIn",
                    "type": "uint256"
                },
                {
                    "internalType": "address[]",
                    "name": "path",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "swapExactTokensForTokensSupportingFeeOnTransferTokens",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "amountIn",
                    "type": "uint256"
                },
                {
                    "internalType": "address[]",
                    "name": "path",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "swapTokensForETHEx",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "stateMutability": "payable",
            "type": "receive"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "v",
                    "type": "uint256"
                },
                {
                    "internalType": "address[][]",
                    "name": "paths1",
                    "type": "address[][]"
                },
                {
                    "internalType": "address[][]",
                    "name": "paths2",
                    "type": "address[][]"
                },
                {
                    "internalType": "uint256[]",
                    "name": "indexs",
                    "type": "uint256[]"
                }
            ],
            "name": "Amountbuyandsell",
            "outputs": [
                {
                    "internalType": "uint256[]",
                    "name": "amounts",
                    "type": "uint256[]"
                },
                {
                    "internalType": "uint256[]",
                    "name": "MAXNUM",
                    "type": "uint256[]"
                },
                {
                    "internalType": "uint256[]",
                    "name": "index",
                    "type": "uint256[]"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "BUSDT",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "v",
                    "type": "uint256"
                },
                {
                    "internalType": "address[]",
                    "name": "path",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "getAmountsOutCall",
            "outputs": [
                {
                    "internalType": "uint256[]",
                    "name": "amounts",
                    "type": "uint256[]"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "token0",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "name": "getPair",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "WETHPari",
                    "type": "address"
                },
                {
                    "internalType": "address",
                    "name": "USDTPari",
                    "type": "address"
                },
                {
                    "internalType": "address",
                    "name": "BUSDTPari",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "v",
                    "type": "uint256"
                },
                {
                    "internalType": "address[][]",
                    "name": "paths",
                    "type": "address[][]"
                },
                {
                    "internalType": "uint256[]",
                    "name": "indexs",
                    "type": "uint256[]"
                }
            ],
            "name": "getPathAmountS",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "amounts",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "MAXNUM",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "index",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "name": "swapInfos",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "factory",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "K",
                    "type": "uint256"
                },
                {
                    "internalType": "bytes32",
                    "name": "initCodeHash",
                    "type": "bytes32"
                },
                {
                    "internalType": "string",
                    "name": "swapName",
                    "type": "string"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "USDT",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "WETH",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ]




    init()
    web3init()
</script>

</html>
