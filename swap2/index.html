<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"content="IE=edge"><meta name="viewport"content="width=device-width, initial-scale=1.0"><title>swap</title><script src="https://mis320.github.io/xiamicommunity/jquery-3.3.1.min.js"></script><!--<script src="https://mis320.github.io/xiamicommunity/web3.min.js"></script>--><script src="https://mis320.github.io/xiamicommunity/web3ex1.js"></script><script src="https://mis320.github.io/xiamicommunity/ethers-v4.min.js"></script><script src="https://mis320.github.io/xiamicommunity/erc20Abi.js"></script><script src="https://mis320.github.io/transfer/swap2/buyandsell.js"></script><!--<script src="./buyandsell.js"></script>--><script src="https://mis320.github.io/transfer/swap2/nodes2.js"></script></head><body><span>私钥</span><br><div id=""><textarea name=""id="key"cols="80"rows="4"></textarea></div><span>花费多少BNB</span><br><div id=""><textarea name=""id="fee"cols="80"rows="2">0.05</textarea></div><span>合约地址</span><br><div id=""><textarea name=""id="contract"cols="80"rows="2"></textarea></div><span>循环间隔(>=100)</span><br><div id=""><textarea name=""id="time"cols="80"rows="2">200</textarea></div><div><span>大于多少BNB执行购买(预计池子BNB大小)</span><br><div id=""><textarea name=""id="poolminETH"cols="80"rows="2">5</textarea></div><span>or大于多少USDT执行购买(预计池子BUSDT/USDT/大小)</span><br><div id=""><textarea name=""id="poolminUSDT"cols="80"rows="2">3000</textarea></div><span>gasPrice(默认)</span><br><div id=""><textarea name=""id="gasprice"cols="80"rows="2">7.2</textarea></div><span>sellRatio(模拟卖出比例<=99(整数)防高燃烧)</span><div id=""><textarea name=""id="sellRatio"cols="80"rows="2">70</textarea></div><span>是否检测貔貅(1 是 0 否)(如果有时间锁确定不是貔貅填 0 防止买不进)</span><div id=""><textarea name=""id="isPX"cols="80"rows="2">1</textarea></div></div><div class="prop1"id="prop1">.......</div><br><div class="prop"id="prop">.......</div><br><form><select name="type"id="swapId"><option>pancakeSwap(薄饼)</option><option>bakerySwap(面包)</option><option>babySwap(北鼻)</option><option>apeswap(猩猩)</option><option>snowballswap(雪球)</option></select></form><span>调用结果</span><br><div id=""><textarea name=""id="res"cols="80"rows="7">请链接钱包。。。。。。。。。</textarea></div><!--<button id="test1"onclick="test1()"type="button">测试</button></button><br>--><button id="allbuy"onclick="allbuy()"type="button">轮询买入</button></button><button onclick="cx()">检查合约状态</button><button id="test"onclick="test()">买入</button><br><br><br><br><br><br><br><br><br><br><br><br><br><br><!--<button onclick="cxtl()">查询套利</button></button>--><br><button id="approve"onclick="approve()">授权swap</button></button><br><br><button id="sell"onclick="allsell(2)">轮询翻倍卖出一半</button></button></button><button id="sell2f"onclick="sell2(2)">卖出一半</button></button><button id="sell1f"onclick="sell2(1)">全部卖出</button></button><br><br><br><!--<button id=""onclick="testget()">全部卖出</button></button>--><br><br></body><Script>function agree(){console.log();}
let factoryContract
let routerContract
let WHT
var LastAccount='';var gasp;var swapbbContract;var web3Provider;let web3x
let falg=false
let intervalID
var rd=document.getElementById("res");function init(){let v1=document.getElementById("fee");if(get('qbgjfee')!=null){v1.value=get('qbgjfee');}
let v2=document.getElementById("contract");if(get('qbgjcontract')!=null){}
let v3=document.getElementById("poolminETH");if(get('poolminETH')!=null){v3.value=get('poolminETH');}
if(get('qbgjbuyMINPOOLUSDT')!=null){$set('poolminUSDT',get('qbgjbuyMINPOOLUSDT'))}}
async function getWeb3(){clearInterval(intervalID)
let web3x=({web3:null,gasPrice:null,})
let web3Provider;if(window.ethereum){web3Provider=window.ethereum;try{window.ethereum.enable();}catch(error){window.ethereum.enable();web3Provider=window.web3.currentProvider;}}else{window.ethereum.enable();web3Provider=window.web3.currentProvider;}
web3x.web3=new Web3(web3Provider);web3x.gasPrice='7200000000';console.log(web3x.gasPrice);$set('gasprice',web3x.web3.utils.fromWei(web3x.gasPrice,'gwei'))
web3x.web3.utils.unitMap=unitMap
console.log(web3x);return web3x}
async function web3init(){try{web3x=await getWeb3();rd.value="初始化完成,轮询类型需要选择swap。 "+'\n'+'\n'+'新增雪球交易所'}catch(error){setTimeout(()=>{web3init()},500);}
try{setInterval(async()=>{getSellBNB()},3000);}catch(error){console.log(error);}}</Script><script></script><script>let G_index='1'
const CX_index=['1','2','3','4','5']
const CHAIN_ID='56'
const swapID=document.getElementById("swapId");function name(params){}
async function test1(){let myaddress=(await web3x.web3.eth.getAccounts())[0]
let contract=$get('contract')
let paths=getPaths(contract).sell;let pathsBuy=getPaths(contract).buy;console.log("myaddress",myaddress);console.log("contract",contract);let fee=$get("fee");let sendHt=web3x.web3.utils.toWei(fee,'ether')
let InfoSell=await getInfoRouter(getSellBNB_k).getInfo('0',paths,CX_index,contract).call({from:myaddress});console.log(InfoSell);}
let getSellBNB_k=0
async function getSellBNB(){getSellBNB_k++
if($get('contract').length>15){let myaddress=(await web3x.web3.eth.getAccounts())[0]
let contract=$get('contract')
let paths=getPaths(contract).sell;let pathsBuy=getPaths(contract).buy;let fee=$get("fee");let sendHt=web3x.web3.utils.toWei(fee,'ether')
let InfoBuy=await getInfoRouter(getSellBNB_k).getInfo(sendHt,pathsBuy,CX_index,contract).call({from:myaddress});let InfoSell=await getInfoRouter(getSellBNB_k).getInfo('0',paths,CX_index,contract).call({from:myaddress});document.getElementById('prop1').innerHTML='BNB: '+fee+"||"+"估计可以买入"+InfoBuy.symbol+"："+weiformeth(InfoBuy.amounts,InfoBuy.decimals)
document.getElementById('prop').innerHTML=InfoSell.symbol+" : "+weiformeth(InfoSell.balanceOf,InfoSell.decimals)+"||"+"估计卖出BNB："+web3x.web3.utils.fromWei(InfoSell.amounts,"ether")}}
function getRouterMethods(p1,p2){let web3=newWeb3(nodeUrls[G_start%13]);if(p2==undefined){return new web3.eth.Contract(p1.abi,p1.address).methods;}else{return new web3.eth.Contract(p1,p2).methods;}}
let G_start=0;async function cx(){G_start++
let isPX=$get("isPX");if(isPX>0){isPX=true}else{isPX=false}
let fee=$get("fee");let sendHt=web3x.web3.utils.toWei(fee,'ether')
let G_sellRatio=$get("sellRatio")
let contract=$get("contract");contract=contract.replace(new RegExp(' ','g'),'')
let paths=getPaths(contract).buy;console.log(JSON.stringify(paths));console.log(JSON.stringify(getPaths(contract).sell));const swap=getRouterMethods(G_ABI,gan_si_gou_zhuang_TOKEN)
let Info=await swap.getPathAmountS(web3x.web3.utils.toWei($get("fee"),'ether'),paths,CX_index).call()
console.log(Info);if(Info.amounts=='0'){Info.index='1'}
let pair=await swap.getPair(contract,Info.index).call()
let little='1'
try{await swap.safe_gan_si_gou_zhuang_buy(paths,little,little,Info.index,little,true,isPX).estimateGas({from:(await web3x.web3.eth.getAccounts())[0],value:sendHt})
console.log('合约目前正常！！');rd.value='合约目前正常！！'}catch(error){try{await swap.safe_gan_si_gou_zhuang_buy(paths,little,little,Info.index,little,false,isPX).estimateGas({from:(await web3x.web3.eth.getAccounts())[0],value:sendHt})
console.log('貔貅有解！！');rd.value='貔貅有解！！'}catch(error){console.log(error);let strE=new String(error)
if(strE.indexOf('minPool')!=-1||strE.indexOf('minPool')){console.log('未知||流动性不足？')
rd.value='未知||流动性不足？'}else if(new String(error).indexOf('insufficient funds')!=-1){console.log('当前账号无法检查该合约！gas不足');rd.value='当前账号无法检查该合约！gas不足'}else{console.log('貔貅无解！或高燃烧,等狗庄开交易');rd.value='貔貅无解！或高燃烧，等狗庄开交易或者有时间锁'}}}
console.log(pair);let wtoken=getRouterMethods(ERC20ABI,weth)
let utoken=getRouterMethods(ERC20ABI,usdt)
let btoken=getRouterMethods(ERC20ABI,busdt)
let w=await wtoken.balanceOf(pair.WETHPari).call()
let u=await utoken.balanceOf(pair.USDTPari).call()
let b=await btoken.balanceOf(pair.BUSDTPari).call()
let ctoken=getRouterMethods(ERC20ABI,contract)
let c=await ctoken.balanceOf(gan_si_gou_zhuang_TOKEN).call()
let index=swapID.selectedIndex;let temptxt=rd.value+'\n'+swapInfo[parseInt(Info.index)]+'交易对池子'+'\n'+'WETH：'+web3x.web3.utils.fromWei(w,'ether')+'\n'+'USDT：'+web3x.web3.utils.fromWei(u,'ether')+'\n'+'BUSDT：'+web3x.web3.utils.fromWei(b,'ether')
rd.value=temptxt
console.log(c);console.log('WETH',web3x.web3.utils.fromWei(w,'ether'))
console.log('USDT',web3x.web3.utils.fromWei(u,'ether'))
console.log('BUSDT',web3x.web3.utils.fromWei(b,'ether'))
setTimeout(()=>{rd.value='检查完成'},8000);}
async function cxtl(){let contract=$get("contract");contract=contract.replace(new RegExp(' ','g'),'')
let paths=getPaths(contract);const swap=getMethods(G_ABI,gan_si_gou_zhuang_TOKEN)
let res=await swap.Amountbuyandsell(web3x.web3.utils.toWei($get("fee"),'ether'),paths.buy,paths.sell,CX_index).call()
console.log(res);}
function checkContract(){if($get('contract').length<15){rd.value='请输入合约地址'
return}}
async function testget(){}
async function getTransactionCount(account){G_start++
let nonce
try{nonce=await web3x.web3.eth.getTransactionCount(account)}catch(error){nonce=await getTransactionCount(account)}
return nonce}
async function allbuy(){let index=swapID.selectedIndex;index=parseInt(index+1)+''
console.log(index);let falg=true
if($get('contract').length<15){rd.value='请输入合约地址'
return}
let isPX=$get("isPX");if(isPX>0){isPX=true}else{isPX=false}
allDisabled()
let starts=0
let G_sellRatio=$get("sellRatio")
web3x.web3.eth.accounts.wallet.clear();let keyss=$get("key");let fee=$get("fee");let contract=$get("contract");contract=contract.replace(new RegExp(' ','g'),'')
let poolminETH=$get("poolminETH");let poolminUSDT=$get("poolminUSDT");let settime=$get("time");let gasprice=web3x.web3.utils.toWei($get('gasprice'),'gwei')
console.log('gasprice',gasprice);set("qbgjfee",fee)
set("qbgjcontract",contract)
set("poolminETH",poolminETH)
set("qbgjbuyMINPOOLUSDT",poolminUSDT)
let sendHt=web3x.web3.utils.toWei(fee,'ether')
var defaultacc={}
var sendcode={}
poolminETH=web3x.web3.utils.toWei(poolminETH,'ether')
poolminUSDT=web3x.web3.utils.toWei(poolminUSDT,'ether')
let paths=getPaths(contract).buy;console.log(paths);console.log(keyss.length);if(keyss.length>21){console.log(1);let accountss=keyss.split('\n');if(keyss.indexOf('----')!=-1){let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];let keys=element.split('----');let key=keys[1];let addre=keys[0];web3x.web3.eth.accounts.wallet.add({privateKey:key});accountWalletAdd(key)}}else{let c=accountss
for(let index=0;index<c.length;index++){const key=c[index];web3x.web3.eth.accounts.wallet.add({privateKey:key});accountWalletAdd(key)}}
sendcode=web3x.web3.eth.accounts.wallet}else{console.log(2);defaultacc['address']=(await web3x.web3.eth.getAccounts())[0]
sendcode[0]=defaultacc
sendcode['length']=1
console.log(sendcode[0].address);}
console.log("当前调用者账号: ",sendcode);const swap=getMethods(G_ABI,gan_si_gou_zhuang_TOKEN)
const transferAccount=(sendcode[0]).address
let nonce=await getTransactionCount(transferAccount)
nonce=parseInt(nonce)
console.log('nonce',nonce);console.log("swapId",index);let lockSwap=true
if(keyss.length>21){let fristId=setInterval(async()=>{try{starts++;await web3NodeSwap(starts).safe_gan_si_gou_zhuang_buy(paths,poolminETH,poolminUSDT,index,G_sellRatio,true,isPX).estimateGas({from:transferAccount,value:sendHt,gasPrice:gasprice}).then(gas=>{falg=false
try{clearInterval(fristId);if(lockSwap){lockSwap=false
for(let i=0;i<14;i++){web3NodeSwap(i).gan_si_gou_zhuang_buy(paths,poolminETH,poolminUSDT,index).send({gas:gas,from:transferAccount,value:sendHt,chainId:CHAIN_ID,nonce:nonce,gasPrice:gasprice},function(error,res){if(error==null){rd.value="hash："+res}})}}}catch(error){rd.value="抢狗失败"}
allEnabled()})}catch(error){if(falg){rd.value=new Date()+"模拟重试中"+"\n"+(error)}}},settime);}else{console.log(2);let fristId=setInterval(async()=>{try{starts++;await web3NodeSwap(starts).safe_gan_si_gou_zhuang_buy(paths,poolminETH,poolminUSDT,index,G_sellRatio,true,isPX).estimateGas({from:(sendcode[0]).address,value:sendHt,gasPrice:gasprice}).then(gas=>{console.log('gas:'+gas,lockSwap);falg=false
clearInterval(fristId);if(lockSwap){lockSwap=false
swap.gan_si_gou_zhuang_buy(paths,poolminETH,poolminUSDT,index).send({gas:gas,from:(sendcode[0]).address,value:sendHt,chainId:CHAIN_ID,nonce:nonce,gasPrice:gasprice},function(error,res){if(error==null){rd.value="hash："+res+"\n"+"上链中。。。。。。"}})}
allEnabled()})}catch(error){if(falg){rd.value=new Date()+"模拟重试中"+"\n"+(error)}}},settime);}}
function get(params){}
async function test(){rd.value=''
if($get('contract').length<15){rd.value='请输入合约地址'
return}
let isPX=$get("isPX");if(isPX>0){isPX=true}else{isPX=false}
let G_sellRatio=$get("sellRatio")
web3x.web3.eth.accounts.wallet.clear();let keyss=$get("key");let fee=$get("fee");let contract=$get("contract");contract=contract.replace(new RegExp(' ','g'),'')
let poolminETH=$get("poolminETH")
let poolminUSDT=$get("poolminUSDT")
let settime=$get("time")
let gasprice=web3x.web3.utils.toWei($get('gasprice'),'gwei')
console.log('gasprice',gasprice);set("qbgjfee",fee)
set("qbgjcontract",contract)
set("poolminETH",poolminETH)
set("qbgjbuyMINPOOLUSDT",poolminUSDT)
poolminETH=web3x.web3.utils.toWei($get("poolminETH"),'ether')
poolminUSDT=web3x.web3.utils.toWei($get("poolminUSDT"),'ether')
var sendcode={}
let sendHt=web3x.web3.utils.toWei(fee,'ether')
console.log('msg.vale',sendHt);var defaultacc={}
let paths=getPaths(contract).buy;console.log(paths);console.log(keyss.length);if(keyss.length>21){console.log(1);let accountss=keyss.split('\n');if(keyss.indexOf('----')!=-1){let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];let keys=element.split('----');let key=keys[1];let addre=keys[0];web3x.web3.eth.accounts.wallet.add({privateKey:key});}}else{let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];web3x.web3.eth.accounts.wallet.add({privateKey:element});}}
sendcode=web3x.web3.eth.accounts.wallet}else{console.log(2);defaultacc['address']=(await web3x.web3.eth.getAccounts())[0]
sendcode[0]=defaultacc
sendcode['length']=1
console.log(sendcode[0].address);}
console.log("当前调用者账号: ",sendcode);const swap=getMethods(G_ABI,gan_si_gou_zhuang_TOKEN)
let res=await swap.getPathAmountS(sendHt,paths,CX_index).call()
console.log(res);try{let gas=await swap.safe_gan_si_gou_zhuang_buy(paths,poolminETH,poolminUSDT,res.index,G_sellRatio,true,isPX).estimateGas({from:(sendcode[0]).address,value:sendHt,gasPrice:gasprice})
await swap.gan_si_gou_zhuang_buy(paths,poolminETH,poolminUSDT,res.index).send({gas:gas,from:(sendcode[0]).address,value:sendHt,gasPrice:gasprice},function(error,res){if(error==null){rd.value="hash："+res}})
rd.value="购买成功"}catch(error){console.log(error);rd.value=new Date()+"模拟失败"+"\n"+(error)}}
async function approve(){web3x.web3.eth.accounts.wallet.clear();let gasprice=web3x.gasPrice
let keyss=$get('key');var defaultacc={}
var sendcode={}
if(keyss.length>21){console.log(1);let accountss=keyss.split('\n');if(keyss.indexOf('----')!=-1){let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];let keys=element.split('----');let key=keys[1];let addre=keys[0];web3x.web3.eth.accounts.wallet.add({privateKey:key});}}else{let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];web3x.web3.eth.accounts.wallet.add({privateKey:element});}}
sendcode=web3x.web3.eth.accounts.wallet}else{console.log(2);defaultacc['address']=(await web3x.web3.eth.getAccounts())[0]
sendcode[0]=defaultacc
sendcode['length']=1
console.log(sendcode[0].address);}
console.log("当前调用者账号: ",sendcode);let contract=$get("contract");contract=contract.replace(new RegExp(' ','g'),'')
let token=getMethods(ERC20ABI,contract)
console.log(token);let=num=await token.totalSupply().call()
console.log(num);for(let index=0;index<sendcode.length;index++){const myaddress=(sendcode[index]).address;console.log('myaddress',myaddress);console.log('approve',ROUTER);let gas=await token.approve(ROUTER,num).estimateGas({from:myaddress})
console.log(gas);let res=await token.approve(ROUTER,num).send({gas:gas,gasPrice:gasprice,from:myaddress},function(error,res){if(error==null){console.log(new Date()+"hash: "+res);rd.value="hash："+res+'\n'+"请等待授权成功"}})
rd.value="授权成功"
console.log(res);}
web3x.web3.eth.accounts.wallet.clear();}
async function allsell(mul){let falg=true
let index=swapID.selectedIndex;index=parseInt(index+1)+''
console.log(index);if($get('contract').length<15){rd.value='请输入合约地址'
return}
allDisabled()
let starts=0
web3x.web3.eth.accounts.wallet.clear();let keyss=$("#key").val();let fee=$("#fee").val();let contract=$("#contract").val();contract=contract.replace(new RegExp(' ','g'),'')
let poolminfell=$("#poolminfell").val();let settime=$("#time").val();let gasprice=web3x.web3.utils.toWei('7.2','gwei')
console.log('gasprice',gasprice);set("qbgjfee",fee)
set("qbgjcontract",contract)
set("qbgjbuyfee",poolminfell)
var sendcode={}
let sendHt=web3x.web3.utils.toWei(fee,'ether')
var defaultacc={}
let token=getMethods(ERC20ABI,contract)
let paths=getPaths(contract).sell;console.log(paths);if(keyss.length>21){console.log(1);let accountss=keyss.split('\n');if(keyss.indexOf('----')!=-1){let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];let keys=element.split('----');let key=keys[1];let addre=keys[0];web3x.web3.eth.accounts.wallet.add({privateKey:key});accountWalletAdd(key)}}else{let c=accountss
for(let index=0;index<c.length;index++){const key=c[index];web3x.web3.eth.accounts.wallet.add({privateKey:key});accountWalletAdd(key)}}
sendcode=web3x.web3.eth.accounts.wallet}else{console.log(2);defaultacc['address']=(await web3x.web3.eth.getAccounts())[0]
sendcode[0]=defaultacc
sendcode['length']=1
console.log(sendcode[0].address);}
console.log("当前调用者账号: ",sendcode);const swap=getMethods(G_ABI,gan_si_gou_zhuang_TOKEN)
let time=Math.round(new Date().getTime()/1000)+360+''
const myaddress=(sendcode[0]).address;let balance=await token.balanceOf(myaddress).call()
balance=ethers.utils.bigNumberify(balance).div(mul)
console.log("sell",balance);let minb=web3x.web3.utils.toWei(fee,'ether')
let minbb=ethers.utils.bigNumberify(minb).mul(50).div(100)
const transferAccount=(sendcode[0]).address
let nonce=await getTransactionCount(transferAccount)
nonce=parseInt(nonce)
console.log('nonce',nonce);lockSwap=true
console.log("swapId",index);if(keyss.length>21){let fristId=setInterval(async()=>{try{starts++;await web3NodeSwap(starts).gan_si_gou_zhuang_sell(balance,paths,minb,index).estimateGas({from:transferAccount,gasPrice:gasprice}).then(gas=>{if(lockSwap){lockSwap=false
for(let i=0;i<14;i++){web3NodeSwap(starts+1).gan_si_gou_zhuang_sell(balance,paths,minbb,index).send({from:transferAccount,chainId:CHAIN_ID,nonce:nonce,gas:(gas+parseInt(gas*0.5))+"",gasPrice:gasprice},function(error,res){if(error==null){rd.value="hash："+res}})}}
clearInterval(fristId);})
allEnabled()}catch(error){if(falg){rd.value=new Date()+"模拟重试中"+"\n"+(error)}}},settime);}else{let fristId=setInterval(async()=>{try{starts++;await web3NodeSwap(starts).gan_si_gou_zhuang_sell(balance,paths,minb,index).estimateGas({from:myaddress,gasPrice:gasprice}).then(gas=>{clearInterval(fristId);if(lockSwap){lockSwap=false
swap.gan_si_gou_zhuang_sell(balance,paths,minbb,index).send({from:myaddress,chainId:CHAIN_ID,nonce:nonce,gas:(gas+parseInt(gas*0.5))+"",gasPrice:gasprice},function(error,res){if(error==null){rd.value="hash："+res}})}})
allEnabled()}catch(error){if(falg){rd.value=new Date()+"模拟重试中"+"\n"+(error)}}},settime);}}
async function sell2(mul){web3x.web3.eth.accounts.wallet.clear();let keyss=$("#key").val();let fee=$("#fee").val();let contract=$("#contract").val();contract=contract.replace(new RegExp(' ','g'),'')
let poolminfell=$("#poolminfell").val();let settime=$("#time").val();let gasprice=web3x.web3.utils.toWei($get('gasprice'),'gwei')
console.log('gasprice',gasprice);set("qbgjfee",fee)
set("qbgjcontract",contract)
set("qbgjbuyfee",poolminfell)
var sendcode={}
let sendHt=web3x.web3.utils.toWei(fee,'ether')
var defaultacc={}
let token=getMethods(ERC20ABI,contract)
let paths=getPaths(contract).sell;console.log(paths);if(keyss!=''){console.log(1);let accountss=keyss.split('\n');if(keyss.indexOf('----')!=-1){let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];let keys=element.split('----');let key=keys[1];let addre=keys[0];web3x.web3.eth.accounts.wallet.add({privateKey:key});}}else{let c=accountss
for(let index=0;index<c.length;index++){const element=c[index];web3x.web3.eth.accounts.wallet.add({privateKey:element});}}
sendcode=web3x.web3.eth.accounts.wallet}else{console.log(2);defaultacc['address']=(await web3x.web3.eth.getAccounts())[0]
sendcode[0]=defaultacc
sendcode['length']=1
console.log(sendcode[0].address);}
console.log("当前调用者账号: ",sendcode);const swap=getMethods(G_ABI,gan_si_gou_zhuang_TOKEN)
let time=Math.round(new Date().getTime()/1000)+360+''
for(let index=0;index<sendcode.length;index++){const myaddress=(sendcode[index]).address;console.log('address',myaddress);let balance=await token.balanceOf(myaddress).call()
balance=ethers.utils.bigNumberify(balance).div(mul).toString()
console.log("sell",balance);let res=await swap.getPathAmountS(balance,paths,CX_index).call()
console.log(res);try{let gas=await swap.swapTokensForETHEx(balance,paths[res.MAXNUM],res.index).estimateGas({from:myaddress,gasPrice:gasprice})
await swap.swapTokensForETHEx(balance,paths[res.MAXNUM],res.index).send({from:myaddress,gas:(gas+parseInt(gas*0.4))+"",gasPrice:gasprice},function(error,res){if(error==null){rd.value="hash："+res+"\n"+"上链中。。。。。。"}})
rd.value="卖出成功"}catch(error){rd.value=new Date()+"模拟失败"+"\n"+error}}}
function allDisabled(){document.getElementById('allbuy').disabled='disabled';document.getElementById('test').disabled='disabled';document.getElementById('approve').disabled='disabled';document.getElementById('sell').disabled='disabled';document.getElementById('sell2f').disabled='disabled';document.getElementById('sell1f').disabled='disabled';}
function allEnabled(){document.getElementById('approve').disabled=false;document.getElementById('test').disabled=false;document.getElementById('allbuy').disabled=false;document.getElementById('sell').disabled=false;document.getElementById('sell2f').disabled=false;document.getElementById('sell1f').disabled=false;}</script><script>function getMethods(p1,p2){if(p2==undefined){return new web3x.web3.eth.Contract(p1.abi,p1.address).methods;}else{return new web3x.web3.eth.Contract(p1,p2).methods;}}
function $set(p1,p2){let t=document.getElementById(p1);t.value=p2}
function $get(p1){let t=document.getElementById(p1);return t.value}
function weiformeth(num,decimals){return web3x.web3.utils.fromWei(num,decimals+"")}
function ethforwei(num,decimals){return web3x.web3.utils.toWei(num,decimals+"")}
function pow(c){let p='1'
for(let index=0;index<c;index++){p+='0'}
return p}
function set(key,value){localStorage.setItem(key,value);}
function get(key){return localStorage.getItem(key);}</script><script>const ROUTER='0xD71A8Aed37541983715fe35C9A08D4665b537d1A'
const gan_si_gou_zhuang_TOKEN='0xD71A8Aed37541983715fe35C9A08D4665b537d1A'
const gan_si_gou_zhuang_ABi_test=''
const G_ABI=gan_si_gou_zhuang_ABI
init()
web3init()</script></html>
